#!/usr/bin/env node

var confd  = require('./index');
var docopt = require('docopt').docopt;

var DEFAULT_PORT = 6868;


function startRest(port)
{
    port = port || DEFAULT_PORT;
    
    console.log('Going to start conf.d service on port "%s"...', port);
    
    // TODO: Start the REST server
}

function startCli(path, subpath)
{
    var conf = confd.from(path).get(subpath);
    
    console.log(JSON.stringify(conf));
}


var options = 'Either starts the conf.d REST server or the command-line reader \n'
            + '  \n'
            + 'Usage: \n'
            + '  confd cli get <PATH> [<SUBPATH>]\n'
            + '  confd rest [--port=<PORT>] \n'
            + '  confd -h | --help \n'
            + '  \n'
            + 'Modes: \n'
            + '  cli  Starts the command-line reader\n'
            + '  rest Starts the REST server\n'
            + '  \n'
            + 'Options: \n'
            + '  get <PATH> <SUBPATH> Read the JSON object from <PATH>, eventually scoped to sub-path <SUBPATH> \n'
            + '  --port=<PORT>        Instructs the REST server to listen on port <PORT>. Default port is ' + DEFAULT_PORT + '. \n'
            + '  -h --help            Shows this help \n';

var cmd = docopt(options);

if (cmd)
{
    console.log('Cmd: %s', JSON.stringify(cmd));
    
    if (cmd.rest)
    {
        startRest(cmd['<PORT>']);
    }
    else if (cmd.cli)
    {
        startCli(cmd['<PATH>'], cmd['<SUBPATH>']);
    }
}
